<div class="loading-shade" *ngIf="loading">
  <mat-progress-spinner 
    mode="indeterminate"
    diameter="50"
    >
  </mat-progress-spinner>
</div>
<mat-form-field>
  <mat-label>Team Leader</mat-label>
  <mat-select (selectionChange)="onSelectTeam($event)">
    <mat-option *ngFor="let tl of teamleaders" [value]="tl">
      {{teams[tl].displayName}}
    </mat-option>
  </mat-select>
</mat-form-field>
<div cdkDropListGroup *ngIf="issues" class="grid">
  <div class="planner-container" *ngFor="let version of versions">
    <h3>{{version.name}}</h3>
    <div
      cdkDropList
      [cdkDropListData]="issues[version.id]"
      class="planner-list"
      cdkDropListSortingDisabled
      [attr.data-versionid]="version.id"
      (cdkDropListDropped)="drop($event)">
      <div class="planner-box" *ngFor="let issue of issues[version.id]; index as i" (contextmenu)="onContextMenu($event, i, version.id)" cdkDrag>
        <span><img src="{{issue.fields.issuetype.iconUrl}}"><a target="_blank" href="{{jiraHost}}/browse/{{issue.key}}">{{issue.fields.summary}}</a></span><span>{{issue.fields.customfield_10132}}</span>
      </div>
    </div>
    <div class="planner-summary">
        <span><strong>CAPACITY / SCHEDULED</strong></span>
        <span [style.background-color]="status(version.id)">{{ teamCapacity(version.id) }} / {{ sum(version.id) }}</span>
    </div>
  </div>    
</div>
<div style="visibility: hidden; position: fixed"
    [style.left]="contextMenuPosition.x"
    [style.top]="contextMenuPosition.y"
    [matMenuTriggerFor]="contextMenu">
</div>
<mat-menu #contextMenu="matMenu">
  <button mat-menu-item [matMenuTriggerFor]="moveSprint">Move Sprint</button>
</mat-menu>
<mat-menu #moveSprint="matMenu">
  <ng-template matMenuContent>
    <button mat-menu-item *ngFor="let version of versions"  (click)="onMoveVersion(version.id)">{{version.name}}</button>
  </ng-template>
</mat-menu>
<div class="command-container">
  <button mat-stroked-button color="primary" [disabled]="!ready" (click)="update()">Update Issues</button>
</div>
<!--
<pre>{{issuesToUpdate | json}}</pre>
-->
